(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{436:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"使用github-actions-实现tp6自动化部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用github-actions-实现tp6自动化部署"}},[s._v("#")]),s._v(" 使用Github Actions 实现TP6自动化部署")]),s._v(" "),a("p",[s._v("通常我们部署网站，都是手动 FTP 推包，手动连上服务器操作。这种方式一是操作烦琐，二是不推崇总是在生产环境人工操作，因为人工操作越多，越容易出错。实现自动化部署后，我们只需要将代码提交到仓库等几分钟，就自动部署好了。")]),s._v(" "),a("p",[s._v("实现代码提交的自动化工作流，要依靠持续集成（或者加上持续交付）服务。现在主流的公用免费的持续集成服务有：")]),s._v(" "),a("ul",[a("li",[s._v("GitHub Actions")]),s._v(" "),a("li",[s._v("Travis CI")]),s._v(" "),a("li",[s._v("Jenkins")]),s._v(" "),a("li",[s._v("Circle CI")]),s._v(" "),a("li",[s._v("Azure Pipeline\n...")])]),s._v(" "),a("p",[s._v("其中 GitHub Actions 是 GitHub 自家的持续集成及自动化工作流服务，简单易用，开源/私有项目都可免费使用（私有项目有限额）。\n它使用起来非常简单，只要在你的仓库根目录建立.github/workflows文件夹，将你的工作流配置(YAML 文件)放到这个目录下，就能启用 GitHub Actions 服务。")]),s._v(" "),a("h2",{attrs:{id:"实现逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现逻辑"}},[s._v("#")]),s._v(" 实现逻辑")]),s._v(" "),a("ul",[a("li",[s._v("使用GitHub Action监听到代码仓库的提交"),a("code",[s._v("push")]),s._v("操作,触发工作流")]),s._v(" "),a("li",[s._v("拉取最新代码推送到服务器")]),s._v(" "),a("li",[s._v("安装依赖"),a("code",[s._v("composer update")])])]),s._v(" "),a("h2",{attrs:{id:"服务器端配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器端配置"}},[s._v("#")]),s._v(" 服务器端配置")]),s._v(" "),a("p",[s._v("为了能让github将仓库代码部署到服务器，需要使用git的密钥对解决登录校验问题。")]),s._v(" "),a("h3",{attrs:{id:"安装git"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装git"}},[s._v("#")]),s._v(" 安装git")]),s._v(" "),a("p",[s._v("链接服务器终端，执行安装命令")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装完成后，查看git版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" --version\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"生成ssh密钥对"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成ssh密钥对"}},[s._v("#")]),s._v(" 生成SSH密钥对")]),s._v(" "),a("h4",{attrs:{id:"_1、创建-ssh文件夹并进入该文件夹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建-ssh文件夹并进入该文件夹"}},[s._v("#")]),s._v(" 1、创建"),a("code",[s._v(".ssh")]),s._v("文件夹并进入该文件夹")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p ~/.ssh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/.ssh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2、生成ssh密钥对"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、生成ssh密钥对"}},[s._v("#")]),s._v(" 2、生成ssh密钥对")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ssh-keygen -t rsa -f mysite\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这里一路回车就行，执行完成后，会在~/.ssh下生成两个文件：mysite（私钥）和mysite.pub（公钥）。其中私钥是你的个人登录凭证，不可以分享给他人，如果别人得到了你的私钥，就能登录到你的服务器。公钥则需要放配置在服务器上。")]),s._v(" "),a("h4",{attrs:{id:"_3、配置公钥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、配置公钥"}},[s._v("#")]),s._v(" 3、配置公钥")]),s._v(" "),a("p",[s._v("如果上一步你直接是在服务器中执行，则只要：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" mysite.pub "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" authorized_keys\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("否则将公钥mysite.pub的内容贴到服务器的~/.ssh/authorized_keys中，若文件或目录不存在，可以自己创建。")]),s._v(" "),a("h4",{attrs:{id:"_4、配置权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、配置权限"}},[s._v("#")]),s._v(" 4、配置权限")]),s._v(" "),a("p",[s._v("确保服务器~/.ssh文件夹的权限低于 711，这里直接用 600（仅本用户可读写）：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" -R ~/.ssh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_5、查看私钥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、查看私钥"}},[s._v("#")]),s._v(" 5、查看私钥")]),s._v(" "),a("p",[s._v("进入到"),a("code",[s._v("~/.ssh")]),s._v("目录，查看私钥文件"),a("code",[s._v("mysite")]),s._v(",将内容复制下来以备后续使用")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看mysite内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" mysite\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("私钥的内容大致如下：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("-----BEGIN RSA PRIVATE KEY-----\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n-----END RSA PRIVATE KEY-----\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"安装composer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装composer"}},[s._v("#")]),s._v(" 安装composer")]),s._v(" "),a("p",[s._v("通常"),a("code",[s._v("vendor")]),s._v("目录是不提交到git仓库的，所以需要在自动部署文件后执行 "),a("code",[s._v("composer update")]),s._v("来更新依赖")]),s._v(" "),a("p",[s._v("1、下载composer")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sS https://getcomposer.org/installer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" php\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("2、将composer.phar文件移动到bin目录以便全局使用composer命令")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" composer.phar /usr/local/bin/composer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("3、切换国内镜像源")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v(" config -g repo.packagist "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v(" https://packagist.phpcomposer.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("4、验证安装成功")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/thinkphp-apidoc/images/course/githubActions/composer.png",alt:"composer安装",title:"composer-install"}})]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("检查php是否禁用"),a("code",[s._v("putenv")]),s._v(","),a("code",[s._v("proc_open")]),s._v("函数，如果禁用了请删除函数的禁用，因为执行"),a("code",[s._v("composer update")]),s._v("更新依赖时需要这些函数的支持。")])]),s._v(" "),a("h2",{attrs:{id:"配置github仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置github仓库"}},[s._v("#")]),s._v(" 配置GitHub仓库")]),s._v(" "),a("p",[s._v("打开你的网站代码仓库，点击 Settings 标签，找到 Secrets 设定")]),s._v(" "),a("p",[a("img",{attrs:{src:"/thinkphp-apidoc/images/course/githubActions/github-settings.png",alt:"github-settings",title:"github-settings"}})]),s._v(" "),a("p",[s._v("添加如下Secret")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("Name")]),s._v(" "),a("th",[s._v("Value")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("SERVER_KEY")]),s._v(" "),a("td",[s._v("-----BEGIN RSA PRIVATE KEY-----...")]),s._v(" "),a("td",[s._v("ssh的私钥，就是"),a("a",{attrs:{href:"#_5%E3%80%81%E6%9F%A5%E7%9C%8B%E7%A7%81%E9%92%A5"}},[s._v("服务器建立ssh的私钥内容")])])]),s._v(" "),a("tr",[a("td",[s._v("SERVER_HOST")]),s._v(" "),a("td",[s._v("如：47.115.160.199")]),s._v(" "),a("td",[s._v("服务器连接地址")])]),s._v(" "),a("tr",[a("td",[s._v("SERVER_PORT")]),s._v(" "),a("td",[s._v("如：22（默认）")]),s._v(" "),a("td",[s._v("服务器连接端口")])]),s._v(" "),a("tr",[a("td",[s._v("SERVER_USERNAME")]),s._v(" "),a("td",[s._v("如：root")]),s._v(" "),a("td",[s._v("服务器登录用户名")])])])]),s._v(" "),a("h2",{attrs:{id:"编写工作流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写工作流"}},[s._v("#")]),s._v(" 编写工作流")]),s._v(" "),a("p",[s._v("在仓库根目录中创建.github/workflows文件夹，再创建一个 YAML 文件，文件名自定，我这里起名叫deploy.yml，所以文件的完整路径为.github/workflows/deploy.yml，我将配置的意义写在注释中，文件内容如下：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deploy Demo "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#工作流名称，可自定义")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 触发条件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只在master上push触发部署")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths-ignore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下列文件的变更不触发部署")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" README.md\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" LICENSE\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("latest "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用ubuntu系统镜像运行自动化脚本")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动化步骤")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" actions/checkout@v2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一步，下载代码仓库")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deploy to Server    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二步，推文件到服务器")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" AEnterprise/rsync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy@v1.0\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DEPLOY_KEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.SERVER_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引用Github配置，SSH私钥")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ARGS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("avz "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("delete "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exclude='"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.env'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exclude='runtime/' "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsync参数，删除服务器目录的文件，排除.env，runtime文件")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SERVER_PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.SERVER_PORT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引用Github配置，SSH端口,默认22")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FOLDER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 要推送的文件夹，路径相对于代码仓库的根目录")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SERVER_IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.SERVER_HOST "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引用Github配置，服务器的host名（IP或者域名domain.com")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("USERNAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.SERVER_USERNAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引用Github配置，服务器登录名")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SERVER_DESTINATION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /www/wwwroot/apidoc.demo/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署到服务器目标文件夹")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Execute Script "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第三步，执行安装依赖")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" appleboy/ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("action@master\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.SERVER_HOST "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面三个配置与上面一样")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.SERVER_USERNAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.SERVER_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入到项目目录，执行依赖更新")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n            cd /www/wwwroot/apidoc.demo/\n            composer update")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("重要提示")]),s._v(" "),a("ul",[a("li",[s._v("以上"),a("code",[s._v("yml")]),s._v("文件使用时去除注释")]),s._v(" "),a("li",[s._v("本部署方式为删除服务器原目录的文件，并将github仓库内的文件部署进去，如服务器项目目录中有不需要删除的文件，必须在"),a("code",[s._v("ARGS")]),s._v("的"),a("code",[s._v("--exclude=''")]),s._v("排除")])])]),s._v(" "),a("h2",{attrs:{id:"测试自动部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试自动部署"}},[s._v("#")]),s._v(" 测试自动部署")]),s._v(" "),a("p",[s._v("把工作流文件写好，提交到仓库。就可以发现 GitHub Actions 已经启动了！可以在提交历史后面的状态，或者 Actions 标签中看到运行的状态。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/thinkphp-apidoc/images/course/githubActions/github-actions.png",alt:"github-actions",title:"github-actions"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);